language: java
jdk:
  - oraclejdk8

cache:
  directories:
  - $HOME/.m2


# Reconstruct the gpg keys to sign the artifacts
before_deploy:
  - echo $GPG_SECRET_KEYS | base64 --decode | $GPG_EXECUTABLE --import --batch || true
  - echo $GPG_OWNERTRUST | base64 --decode | $GPG_EXECUTABLE --import-ownertrust --batch || true

deploy:
  -
    provider: script
    skip_cleanup: true
    script: mvn -DskipTests --settings .travis/settings.xml
    on:
      tags: false
  -
    provider: script
    skip_cleanup: true
    script: mvn install -Prelease -DskipTests --settings .travis/settings.xml
    on:
      tags: true
  -
    provider: releases
    api_key:
      secure: 2syZNiDjbsumheh/T/XGZEFuaLZ7gdbTKVeL9KUrP4SVJKeIsSE3LYKSKHpfYJVn1tIPQxgMlQX7d76oywnAobB6v9uYve9oVb0d6FHRx/SYhpS/djhRueFMO4TWXj0JyJwg6YmbxszDyEOqgJA51/Qmb7ZGRsx42/Cct4NlyJ/y6KMb0EHORENFPKx74/934clA+SCGR1fh9AZ1VSNbhl1UoxIpQnUl5YFX+a3kcix+kM/vpXEEhBMVXdTfQb39iY6P3ancj5EPNS7VkCvCnuYXzmg73GbbTpvBiUvvwQybfd/Iyr/1YjC5mV9liOospnO1PmESrBdaPqTlWvrL1KjtJOKHjDVe6T3FBQ3w618jfGVBGb58fgHVdK8RlAKAcvyZXG/N8empwtvuotM/ZkTuIvpMEpRO3cVo5MSsjgDfQPv74R6xv4G38kIcPPkakrM/+Vqw/Al/lyUW4SKHNIH5Oz6OLceaaFtP03a5h5F07+K/sspiyepEsG1dOh6EjpvWNdKxvzQxPQRDCfQleQz0azXZ7Hlf9xYoR8GGmjZnM953bag6w9X4UFbP4+G+tkJ5xCQS0f62jrmDXblbXFI9cKIRVc7TjnYITUQuJVeNVRNqDyYm0rztx05QcL27bSdEICLfnfwMCi2x/a6HsZBrwbLTKlhVGXSdIfMavuQ=
    file_glob: true
    file: "all/target/pulsar-*.tar.gz"
    on:
      repo: yahoo/pulsar
      tags: true
      skip_cleanup: true
